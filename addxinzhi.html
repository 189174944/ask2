<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <title>添加文章</title>
    <link rel="stylesheet" media="all" href="css/animate.min.css" />
    <link rel="stylesheet" type="text/css" href="css/semantic.css">
    <link rel="stylesheet" media="all" href="css/zhongchou.css" />
    <link rel="stylesheet" media="all" href="css/common.css" />
    <link rel="stylesheet" type="text/css" href="css/header.css">
    <link rel="stylesheet" media="all" href="css/custom.css" />
    <script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
</head>
<body class="wshui">
<div class="gudin">
    <div class="pageIndex">
        <div class="page-right">
            <div class="nav-top">
                <div class="logo-img"><a href="./"> <img src="images/logo.png"></a></div>
                <form action="./" method="get">
                    <div class="ui icon input">
                        <input class="prompt" type="text" name="search" placeholder="搜索你感兴趣的内容" />
                        <i class="search icon"></i>
                    </div>&nbsp; &nbsp;
                    <div class="tiwen"><input type="submit" class="ui primary button " value="提问"></div>
                    <div class="choice"><i class="idea icon"></i>回答</div>
                    <div class="choice"><a href="http://192.168.10.103/ui27/addxinzhi.html" ><i class="edit icon"></i>写文章</a></div>
                    <div class="choice news">消息<span class="label">19</span></div>
                    <div class="login">
                        <ul>
                            <li><a href="#"> 注册 </a> | <a href="#"> 登录 </a></li>

                        </ul>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>


<!--用户中心-->




<div class="user-home bg-white" >
    <div class="container index">
        <form class="form-horizontal mar-t-1" action="http://192.168.10.103/ask2/index.php?user/addxinzhi.html"  method="post" enctype="multipart/form-data">
            <div class="row main">
                <div class="col-md-20">
                    <div class="dongtai">
                        <p>
                            <strong class="font-18">发表文章</strong>
                        </p>
                        <hr>

                        <input type="hidden" name="topicclass" value="" id="topicclass"/>
                        <input type="hidden" name="upimg" id="upimg" value=""/>
                        <input type="hidden" name="views" value=""/>
                        <div class="form-group">

                            <div class="col-md-24 has-error">
                                <input type="text" name="title" value="" size="50" class="title" placeholder="文章标题不能为空">
                                <div class="help-block alert alert-primary ">


                                    <div class="bar_l">

                        <span><a  class="btn btn-success"   id="changecategory" href="javascript:showcategory()">选择文章分类</a>
                     <span id="selectedcate" class="selectedcate mar-lr-1"></span>
 </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <p class="col-md-24  text-left fl">  文章标签,多个用英文逗号隔开,最多5个:</p>
                            <div class="col-md-24 has-error">
                                <input type="text" data-toggle="tooltip" data-placement="bottom" title="" placeholder="标签之间英文逗号隔开" data-original-title="英文逗号隔开,最多5个" name="topic_tag" value=""  class="txt_tag" >

                            </div>
                        </div>
                        <div class="form-group">
                            <p class="col-md-24  text-left fl">文章描述:</p>
                            <div class="col-md-24 has-error">
                                <!--引入wangEditor.css-->
                                <link rel="stylesheet" type="text/css" href="http://192.168.10.103/ask2/static/js/wangeditor/pcwangeditor/css/wangEditor.min.css">



                                <!--引入jquery和wangEditor.js-->   <!--注意：javascript必须放在body最后，否则可能会出现问题-->

                               <textarea  id="editor" name="content"   style="width:100%;height:200px;">

                                 </textarea>
                                <script type="text/javascript">


                                    var isueditor=0;
                                    // 初始化编辑器的内容
                                    var editor = new wangEditor('editor');
                                    // 自定义配置
                                    editor.config.uploadImgUrl = g_site_url+"index.php?attach/upimg" ;
                                    editor.config.uploadImgFileName = 'wangEditorMobileFile';
                                    // 阻止输出log
                                    wangEditor.config.printLog = false;
                                    // 普通的自定义菜单
                                    editor.config.menus = [

                                        'source', '|', 'bold', 'underline', 'italic', 'strikethrough', 'eraser', 'forecolor', 'bgcolor', '|', 'quote', 'fontfamily', 'fontsize', 'head', 'unorderlist', 'orderlist', 'alignleft', 'aligncenter', 'alignright', '|', 'link', 'unlink', 'table', 'emotion', '|', 'img', 'video', 'location', 'insertcode', '|', 'undo', 'redo', 'fullscreen'     ];
                                    // 将全屏时z-index修改为20000
                                    // editor.config.zindex =-1;
                                    editor.create();
                                    $(".wangEditor-container").css("z-index","1");


                                </script>          </div>
                        </div>






                    </div>


                </div>
                <div class="col-md-8">

                    <div class="fenmian" >

                        <p>封面图:</p>
                        <div class="form-group">

                            <div class="col-md-24">
                                <div id="preview" style="overflow:visible">
                                    <img class="img-thumbnail" style="width:288px;height:192px;" data-caption="" id="imghead" style="max-height: 300px;" border=0 src='http://192.168.10.103/ask2/static/css/dist/css/images/default.jpg'>
                                </div>
                                <div class="add-img-box row">
                                    <div class="col-sm-24">
    <span class="add-img" >
  <a id="layerUploadButton"></a></span>
                                        <div class="add-img-html5" style=""><span>
  </span><a class="text-danger" href="###"  data-toggle="tooltip" data-placement="bottom" title="点击这选择封面图片，大小建议288px*192px,或者填封面图外部链接" style="font-size:12px;cursor:pointer;margin-top:3px;"><i class="fa fa-image" ></i>点我上传封面图
                                            </a>
                                            <input type="file" id="layer_upload" onchange="previewImage(this)" name="image" title="点击这选择封面图片，大小建议288px*192px,或者填封面图外部链接" style="opacity: 0;height: 40px;position:relative;top:-2rem;">

                                        </div>
                                    </div>

                                </div>

                                <div class="add-img-box row">
                                    <div class="col-sm-24">
                                        <div class="price_set" data-toggle="tooltip" data-placement="bottom" title=""  data-original-title="默认不需要积分可以阅读">
                                            <span>阅读需要</span>
                                            <input type="number" AUTOCOMPLETE="OFF" id="topic_price" name="topic_price" value="0" size="100" class="txt_price" placeholder="可以留空">
                                            <span>积分</span>
                                        </div>

                                    </div>
                                    <div class="col-sm-24 wiabu">
                                        外部封面图地址:(<a class="text-danger" href="javascript:getimg()">点击内容提取</a>)
                                        <input type="text" AUTOCOMPLETE="OFF" id="outimgurl" name="outimgurl" value="http://192.168.10.103/ask2/static/css/dist/css/images/default.jpg" size="350" class="form-control" placeholder="如果不上传可以选择外部封面图片地址">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- -待续 -->

                        <div class="form-group">
                            <div class=" col-md-20">

                                <input type="hidden" name="usersid" value=''/>

                                <input type="submit" id='article_btn' class="btn btn-success width-120" name="submit"  value="提 交">
                                <input type="button" onclick="getimg()" class="btn btn-default width-120 mar-ly-1" name="submit"  value="内容提取封面图">

                            </div>
                        </div>

                        <div class="modal fade" id="myLgModal" style="z-index:999999999">
                            <div class="modal-dialog modal-md" style="width: 460px; top: 50px;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
                                        <h4 class="modal-title">选择分类</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div id="dialogcate">
                                            <form name="editcategoryForm" action="http://192.168.10.103/ask2/index.php?question/movecategory.html" method="post">
                                                <input type="hidden" name="qid" value="" />
                                                <input type="hidden" name="category" id="categoryid" />
                                                <input type="hidden" name="selectcid1" id="selectcid1" value="" />
                                                <input type="hidden" name="selectcid2" id="selectcid2" value="" />
                                                <input type="hidden" name="selectcid3" id="selectcid3" value="" />
                                                <table class="table table-striped">
                                                    <tr valign="top">
                                                        <td width="125px">
                                                            <select  id="category1" class="catselect" size="8" name="category1" ></select>
                                                        </td>
                                                        <td align="center" valign="middle" width="25px"><div style="display: none;" id="jiantou1">>></div></td>
                                                        <td width="125px">
                                                            <select  id="category2"  class="catselect" size="8" name="category2" ></select>
                                                        </td>
                                                        <td align="center" valign="middle" width="25px"><div style="display: none;" id="jiantou2">>>&nbsp;</div></td>
                                                        <td width="125px">
                                                            <select id="category3"  class="catselect" size="8"  name="category3" ></select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="5">
                    <span>
                    <input  type="button" id="layer-submit" class="btn btn-success" value="确&nbsp;认" onclick="selectcate();"/></span>
                    <span>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </span>
                                                        </td>

                                                    </tr>
                                                </table>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </form>

    </div>


</div>



<!--用户中心结束-->
<script type="text/javascript">
    window.onload=function(){
        $(".dongtai .title").focus();

    }
    function getimg(){

        var _html='';
        if(isueditor==1){
            _html = editor.getContent();
        }else{
            _html = editor.wang_txt.html();
        }

        var firstimg=$(_html).find("img");

        if(firstimg!=null){
            $("#imghead").attr("src",firstimg[0].src);

            $("#imghead").attr("data-image",firstimg[0].src);
            $("#outimgurl").val(firstimg[0].src);
        }

    }
    var category1 = [["2","看书"],["1","默认分类"],["3","画画"],["4","打游戏"]];
    var category2 = [["2","5","阿斯顿"],["2","6","3123123"],["2","7","123123"],["2","8","123123"]];
    var category3 = [];
    $(document).ready(function() {
        initcategory(category1);




    });
    function selectcate() {
        var selectedcatestr = '';
        var category1 = $("#category1 option:selected").val();
        var category2 = $("#category2 option:selected").val();
        var category3 = $("#category3 option:selected").val();
        if (category1 > 0) {
            selectedcatestr = $("#category1 option:selected").html();
            $("#topicclass").val(category1);

        }
        if (category2 > 0) {
            selectedcatestr += " > " + $("#category2 option:selected").html();
            $("#topicclass").val(category2);

        }
        if (category3 > 0) {
            selectedcatestr += " > " + $("#category3 option:selected").html();
            $("#topicclass").val(category3);

        }
        $("#selectedcate").html(selectedcatestr);
        $("#changecategory").html("更改");
        $("#myLgModal").modal("hide");
    }
</script>



<script type="text/javascript">
    $("#myLgModal .modal-dialog").css("width","460px");
    function showcategory(){
        $('#myLgModal').modal({
            position    :50,
            moveable : true,
            show     : true
        })
    }
    $("#article_btn").click(function(){
        var v=$("#topicclass").val();
        var fv=$("#layer_upload").val();
        var upfv=$("#outimgurl").val();
        if(v==''){
            alert("请选择文章分类");
            showcategory();
            return false;
        }
        if(fv==''&&upfv==''){


            alert("请选择文章封面图");
            return false;
        }
    })

    function checkarticle(){
        if($("#topicclass")==''){
            alert("请选择文章分类");
            return false;
        }
    }
    //图片上传预览    IE是用了滤镜。
    function previewImage(file)
    {
        var MAXWIDTH  = 300;
        var MAXHEIGHT = 240;
        var div = document.getElementById('preview');
        if (file.files && file.files[0])
        {
            div.innerHTML =' <a target="_blank" id="imgshowlink" href="" data-toggle="lightbox" data-group="image-group-1"><img class="img-thumbnail" id=imghead></a>';
            var img = document.getElementById('imghead');
            img.onload = function(){
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
                img.width  =  rect.width;
                img.height =  rect.height;
//                 img.style.marginLeft = rect.left+'px';
                img.style.marginTop = rect.top+'px';
            }
            var reader = new FileReader();
            reader.onload = function(evt){
                img.src = evt.target.result;
                $("#imghead").attr("data-img",evt.target.result);
                $("#imgshowlink").attr("href",evt.target.result);

            }
            reader.readAsDataURL(file.files[0]);
        }
        else //兼容IE
        {
            var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
            file.select();
            var src = document.selection.createRange().text;
            div.innerHTML = '<img class="img-thumbnail" data-caption="" data-toggle="lightbox" id=imghead>';
            var img = document.getElementById('imghead');
            img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
            var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
            status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
            div.innerHTML = "<div id=divhead style='width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
        }
    }
    function clacImgZoomParam( maxWidth, maxHeight, width, height ){
        var param = {top:0, left:0, width:width, height:height};
        if( width>maxWidth || height>maxHeight )
        {
            rateWidth = width / maxWidth;
            rateHeight = height / maxHeight;

            if( rateWidth > rateHeight )
            {
                param.width =  maxWidth;
                param.height = Math.round(height / rateWidth);
            }else
            {
                param.width = Math.round(width / rateHeight);
                param.height = maxHeight;
            }
        }

        param.left = Math.round((maxWidth - param.width) / 2);
        param.top = Math.round((maxHeight - param.height) / 2);
        return param;
    }
</script>


